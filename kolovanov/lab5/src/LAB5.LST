Microsoft (R) Macro Assembler Version 5.10                  4/19/21 22:50:44
                                                             Page     1-1


				.model small
				.stack 100h
				
				.code
				
 0000				INTERRUPT_HANDLER PROC FAR
 0000  EB 0D 90				jmp interrupt_handler_start
				
 0003  0F 0F FF 00			INTERRUPT_HANDLER_ID DB 0Fh, 0Fh, 0FFh,
				 00h
 0007  0000				KEEP_CS DW 0h
 0009  0000				KEEP_IP DW 0h
 000B  00000000				INT_9_ADDR DD 0h
				
 000F				interrupt_handler_start:
 000F  50				push ax
 0010  51				push cx
					
				; –ü–æ–ª—É—á–∞–µ–º –±–∞–π—Ç—ã —Å–æ—Å—Ç–æ—è–Ω–∏—
				è
 0011  06				push es
 0012  B9 0040				mov cx, 040h
 0015  8E C1				mov es, cx
 0017  26: 8B 0E 0017			mov cx, es:[0017h]
 001C  07				pop es
				
				; –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–∂–∞—Ç–∞ –ª–∏ –∫–ª–∞–
				≤–∏—à–∞ Alt. –ï—Å–ª–∏ –¥–∞, —Ç–æ –ø—Ä–æ–≤–µ—Ä—è
				–µ–º –¥–∞–ª—å—à–µ, –∏–Ω–∞—á–µ - –ø–µ—Ä–µ—Ö–æ–¥–
				∏–º –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—
				á–∏–∫
 001D  83 E1 08				and cx, 01000b
 0020  83 F9 00				cmp cx, 0
 0023  74 0A				je call_old_int
				
				; –ï—Å–ª–∏ –Ω–∞–∂–∞—Ç–∞ –∫–ª–∞–≤–∏—à–∞ 'J' –∏–ª
				–∏ 'K', —Ç–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º, –∏–Ω–∞—á
				–µ - –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω
				—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
 0025  E4 60				in al, 60h 
 0027  3C 24				cmp al, 24h 
 0029  74 0B				je do_req
					
 002B  3C 25				cmp al, 25h 
 002D  74 07				je do_req
				
 002F				call_old_int:
 002F  59				pop cx
 0030  58				pop ax
 0031  2E: FF 2E 000B R			jmp dword ptr cs:[INT_9_ADDR]
				
 0036				do_req:
				; –ü–æ—Å—ã–ª–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ –ø–æ–¥—
				Ç–≤–µ—Ä–∂–¥–∞—é—â–∏–π —Å–∏–≥–Ω–∞–ª
Microsoft (R) Macro Assembler Version 5.10                  4/19/21 22:50:44
                                                             Page     1-2


 0036  E4 61				in al, 61H 
 0038  8A E0				mov ah, al 
 003A  0C 80				or al, 80h 
 003C  E6 61				out 61H, al
 003E  86 E0				xchg ah, al 
 0040  E6 61				out 61H, al
					
 0042  B0 20				mov al, 20h
 0044  E6 20				out 20h, al 
					
				; –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ –±—É—Ñ–µ—Ä —Å–∏–º–≤–æ
				–ª '!'
 0046				write_symbol:
 0046  B4 05				mov ah, 05h
 0048  B1 21				mov cl, '!'
 004A  B5 00				mov ch, 00h
 004C  CD 16				int 16h
 004E  0A C0				or al, al
 0050  74 13				jz end_int
					
				; –û—á–∏—â–∞–µ–º –±—É—Ñ–µ—Ä, –µ—Å–ª–∏ –æ–Ω –∑–∞
				–ø–æ–ª–Ω–µ–Ω
 0052  06				push es
 0053  FA				cli
 0054  B8 0040				mov ax, 0040h
 0057  8E C0				mov es, ax	
 0059  26: A0 001A			mov al, es:[001Ah]	
 005D  26: A2 001C			mov es:[001Ch], al
 0061  FB				sti
 0062  07				pop es
 0063  EB E1				jmp write_symbol
					
 0065				end_int:
 0065  59				pop cx
 0066  58				pop ax
				
 0067  CF				iret
 0068				INTERRUPT_HANDLER ENDP
				
 0068				GET_INTERRUPT_HANDLER PROC NEAR
 0068  50				push ax
				
 0069  B4 35				mov ah, 35h
 006B  B0 09				mov al, 09h
 006D  CD 21				int 21h
				
 006F  58				pop ax
				
 0070  C3				ret
 0071				GET_INTERRUPT_HANDLER ENDP
				
 0071				RESTORE_INTERRUPT_HANDLER PROC NEAR
 0071  50				push ax
 0072  53				push bx
Microsoft (R) Macro Assembler Version 5.10                  4/19/21 22:50:44
                                                             Page     1-3


 0073  52				push dx
 0074  06				push es
				
				; –î–æ—Å—Ç–∞–µ–º —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –æ–
				±—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π
 0075  E8 0068 R			call GET_INTERRUPT_HANDLER
 0078  06				push es
				
				; –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏
				–µ —Å—Ç–∞—Ä–æ–≥–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –ø—Ä–µ
				—Ä—ã–≤–∞–Ω–∏–π
 0079  1E				push ds
 007A  FA				cli
 007B  26: A1 0007 R			mov ax, es:[KEEP_CS]
 007F  26: 8B 16 0009 R			mov dx, es:[KEEP_IP]
 0084  8E D8				mov ds, ax 
 0086  B4 25				mov ah, 25h
 0088  B0 09				mov al, 09h 
 008A  CD 21				int 21h
 008C  FB				sti
 008D  1F				pop ds
				
 008E  BA 0061 R			mov dx, offset INTERRUPT_HANDLER_RESTOR
				E_MESSAGE
 0091  E8 012A R			call PRINT
				
				; –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º –ø–∞–º—è—Ç—å
 0094  07				pop es
 0095  8C C2				mov dx, es
 0097  B4 62				mov ah, 62h
 0099  CD 21				int 21h
 009B  B8 ---- R			mov ax, @code
 009E  2B C3				sub ax, bx
 00A0  2B D0				sub dx, ax
 00A2  8E C2				mov es, dx
				
 00A4  26: 8B 16 002C			mov dx, es:[2Ch]
 00A9  B4 49				mov ah, 49h
 00AB  CD 21				int 21h
				
 00AD  8E C2				mov es, dx
 00AF  B4 49				mov ah, 49h
 00B1  CD 21				int 21h
				
 00B3  07				pop es
 00B4  5A				pop dx
 00B5  5B				pop bx
 00B6  58				pop ax
				
 00B7  C3				ret
 00B8				RESTORE_INTERRUPT_HANDLER ENDP
				
 00B8				SET_INTERRUPT_HANDLER PROC NEAR
 00B8  50				push ax
Microsoft (R) Macro Assembler Version 5.10                  4/19/21 22:50:44
                                                             Page     1-4


 00B9  51				push cx
 00BA  52				push dx
 00BB  06				push es
 00BC  1E				push ds
				
				; –î–æ—Å—Ç–∞–µ–º —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –æ–
				±—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π –∏ —Å–æ—
				Ö—Ä–∞–Ω—è–µ–º –µ–≥–æ
 00BD  E8 0068 R			call GET_INTERRUPT_HANDLER
 00C0  2E: 8C 06 0007 R			mov KEEP_CS, es
 00C5  2E: 89 1E 0009 R			mov KEEP_IP, bx
 00CA  2E: 89 1E 000B R			mov word ptr INT_9_ADDR, bx
 00CF  2E: 8C 06 000D R			mov word ptr INT_9_ADDR + 2, es
				
				; –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤—ã–π –æ–±—Ä–
				∞–±–æ—Ç—á–∏–∫ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π
 00D4  FA				cli 
 00D5  B8 ---- R			mov ax, seg INTERRUPT_HANDLER
 00D8  BA 0000 R			mov dx, offset INTERRUPT_HANDLER
 00DB  8E D8				mov ds, ax 
 00DD  B4 25				mov ah, 25h 
 00DF  B0 09				mov al, 09h
 00E1  CD 21				int 21h
 00E3  FB				sti
				
 00E4  1F				pop ds
 00E5  BA 0000 R			mov dx, offset INTERRUPT_HANDLER_INSTAL
				L_MESSAGE
 00E8  E8 012A R			call PRINT
				
 00EB  07				pop es
 00EC  5A				pop dx
 00ED  59				pop cx
 00EE  58				pop ax
				
 00EF  C3				ret
 00F0				SET_INTERRUPT_HANDLER ENDP
				
 00F0				CHECK_INTERRUPT_HANDLER PROC NEAR
 00F0  53				push bx
 00F1  51				push cx
 00F2  56				push si
 00F3  57				push di
 00F4  06				push es
 00F5  1E				push ds
				
				; –î–æ—Å—Ç–∞–µ–º —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –æ–
				±—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π
 00F6  E8 0068 R			call GET_INTERRUPT_HANDLER
				
				; –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–∏–≥–Ω–∞—Ç—É—Ä—É
 00F9  B8 0000				mov ax, 0
 00FC  26: 8A 4F 03			mov cl, es:[bx + 3]
 0100  80 F9 0F				cmp cl, 0Fh
Microsoft (R) Macro Assembler Version 5.10                  4/19/21 22:50:44
                                                             Page     1-5


 0103  75 1E				jne end_check
 0105  26: 8A 4F 04			mov cl, es:[bx + 4]
 0109  80 F9 0F				cmp cl, 0Fh
 010C  75 15				jne end_check
 010E  26: 8A 4F 05			mov cl, es:[bx + 5]
 0112  80 F9 FF				cmp cl, 0FFh
 0115  75 0C				jne end_check
 0117  26: 8A 4F 06			mov cl, es:[bx + 6]
 011B  80 F9 00				cmp cl, 00h
 011E  75 03				jne end_check
 0120  B8 0001				mov ax, 1
				
 0123				end_check:
 0123  1F				pop ds
 0124  07				pop es
 0125  5F				pop di
 0126  5E				pop si
 0127  59				pop cx
 0128  5B				pop bx
				
 0129  C3				ret 
 012A				CHECK_INTERRUPT_HANDLER ENDP
				
 012A				PRINT PROC NEAR
 012A  50				push ax
 012B  B4 09				mov ah, 09h
 012D  CD 21				int 21h
 012F  58				pop ax
 0130  C3				ret
 0131				PRINT ENDP
				
 0131				BEGIN:
 0131  B8 ---- R			mov ax, @data
 0134  8E D8				mov ds, ax
				
				; –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ñ–ª–∞–≥–∞ 
				/un
 0136  26: 80 3E 0082 2F		cmp byte ptr es:[81h + 1], '/'
 013C  75 36				jne check_handler
 013E  26: 80 3E 0083 75		cmp byte ptr es:[81h + 2], 'u'
 0144  75 2E				jne check_handler
 0146  26: 80 3E 0084 6E		cmp byte ptr es:[81h + 3], 'n'
 014C  75 26				jne check_handler
				
 014E  E8 00F0 R			call CHECK_INTERRUPT_HANDLER
 0151  3D 0000				cmp ax, 0
 0154  74 06				je handler_isnt_setted
 0156  E8 0071 R			call RESTORE_INTERRUPT_HANDLER
 0159  EB 27 90				jmp exit
					
				; –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è –Ω–
				µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
 015C				handler_isnt_setted:
 015C  BA 0094 R			mov dx, offset INTERRUPT_HANDLER_NOT_SE
Microsoft (R) Macro Assembler Version 5.10                  4/19/21 22:50:44
                                                             Page     1-6


				T_MESSAGE
 015F  E8 012A R			call PRINT
 0162  EB 1E 90				jmp exit
				
				; –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏
				–∫ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π
 0165				set_handler:
 0165  E8 00B8 R			call SET_INTERRUPT_HANDLER
				
 0168  BA 0188 R			mov dx, offset interrupt_handler_end
 016B  B1 04				mov cl, 4
 016D  D3 EA				shr dx, cl 
 016F  42				inc dx
 0170  B4 31				mov ah, 31h 
 0172  CD 21				int 21h
				
				; –ü—Ä–æ–≤–µ—Ä—è–µ–º, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ª–∏
				 –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π
 0174				check_handler:
 0174  E8 00F0 R			call CHECK_INTERRUPT_HANDLER
 0177  3D 0000				cmp ax, 0
 017A  74 E9				je set_handler
 017C  BA 0033 R			mov dx, offset INTERRUPT_HANDLER_ALREAD
				Y_SET_MESSAGE
 017F  E8 012A R			call PRINT
				
				; –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –ø—Ä–æ–≥—Ä–
				∞–º–º—ã
 0182				exit:
 0182  32 C0				xor al, al
 0184  B4 4C				mov ah, 4Ch
 0186  CD 21				int 21h
				
 0188				interrupt_handler_end:
				
				.data
 0000  54 68 65 20 69 6E		INTERRUPT_HANDLER_INSTALL_MESSAGE DB "T
				he interrupt handler is successfully installed.
				", 0Dh, 0Ah, "$"
       74 65 72 72 75 70	
       74 20 68 61 6E 64	
       6C 65 72 20 69 73	
       20 73 75 63 63 65	
       73 73 66 75 6C 6C	
       79 20 69 6E 73 74	
       61 6C 6C 65 64 2E	
       0D 0A 24			
 0033  54 68 65 20 69 6E		INTERRUPT_HANDLER_ALREADY_SET_MESSAGE D
				B "The interrupt handler is already installed."
				, 0Dh, 0Ah, "$"
       74 65 72 72 75 70	
       74 20 68 61 6E 64	
       6C 65 72 20 69 73	
       20 61 6C 72 65 61	
Microsoft (R) Macro Assembler Version 5.10                  4/19/21 22:50:44
                                                             Page     1-7


       64 79 20 69 6E 73	
       74 61 6C 6C 65 64	
       2E 0D 0A 24		
 0061  54 68 65 20 69 6E		INTERRUPT_HANDLER_RESTORE_MESSAGE DB "T
				he interrupt handler was successfully restored.
				", 0Dh, 0Ah, "$"
       74 65 72 72 75 70	
       74 20 68 61 6E 64	
       6C 65 72 20 77 61	
       73 20 73 75 63 63	
       65 73 73 66 75 6C	
       6C 79 20 72 65 73	
       74 6F 72 65 64 2E	
       0D 0A 24			
 0094  54 68 65 20 69 6E		INTERRUPT_HANDLER_NOT_SET_MESSAGE DB "T
				he interrupt handler is not installed yet.", 0D
				h, 0Ah, "$"
       74 65 72 72 75 70	
       74 20 68 61 6E 64	
       6C 65 72 20 69 73	
       20 6E 6F 74 20 69	
       6E 73 74 61 6C 6C	
       65 64 20 79 65 74	
       2E 0D 0A 24		
				
				END BEGIN
Microsoft (R) Macro Assembler Version 5.10                  4/19/21 22:50:44
                                                             Symbols-1


Segments and Groups:

                N a m e         	Length	 Align	Combine Class

DGROUP . . . . . . . . . . . . .  	GROUP
  _DATA  . . . . . . . . . . . .  	00C2	WORD	PUBLIC	'DATA'
  STACK  . . . . . . . . . . . .  	0100	PARA	STACK	'STACK'
_TEXT  . . . . . . . . . . . . .  	0188	WORD	PUBLIC	'CODE'

Symbols:            

                N a m e         	Type	 Value	 Attr

BEGIN  . . . . . . . . . . . . .  	L NEAR	0131	_TEXT

CALL_OLD_INT . . . . . . . . . .  	L NEAR	002F	_TEXT
CHECK_HANDLER  . . . . . . . . .  	L NEAR	0174	_TEXT
CHECK_INTERRUPT_HANDLER  . . . .  	N PROC	00F0	_TEXT	Length = 003A

DO_REQ . . . . . . . . . . . . .  	L NEAR	0036	_TEXT

END_CHECK  . . . . . . . . . . .  	L NEAR	0123	_TEXT
END_INT  . . . . . . . . . . . .  	L NEAR	0065	_TEXT
EXIT . . . . . . . . . . . . . .  	L NEAR	0182	_TEXT

GET_INTERRUPT_HANDLER  . . . . .  	N PROC	0068	_TEXT	Length = 0009

HANDLER_ISNT_SETTED  . . . . . .  	L NEAR	015C	_TEXT

INTERRUPT_HANDLER  . . . . . . .  	F PROC	0000	_TEXT	Length = 0068
INTERRUPT_HANDLER_ALREADY_SET_M   	L BYTE	0033	_DATA
INTERRUPT_HANDLER_END  . . . . .  	L NEAR	0188	_TEXT
INTERRUPT_HANDLER_ID . . . . . .  	L BYTE	0003	_TEXT
INTERRUPT_HANDLER_INSTALL_MESSA   	L BYTE	0000	_DATA
INTERRUPT_HANDLER_NOT_SET_MESSA   	L BYTE	0094	_DATA
INTERRUPT_HANDLER_RESTORE_MESSA   	L BYTE	0061	_DATA
INTERRUPT_HANDLER_START  . . . .  	L NEAR	000F	_TEXT
INT_9_ADDR . . . . . . . . . . .  	L DWORD	000B	_TEXT

KEEP_CS  . . . . . . . . . . . .  	L WORD	0007	_TEXT
KEEP_IP  . . . . . . . . . . . .  	L WORD	0009	_TEXT

PRINT  . . . . . . . . . . . . .  	N PROC	012A	_TEXT	Length = 0007

RESTORE_INTERRUPT_HANDLER  . . .  	N PROC	0071	_TEXT	Length = 0047

SET_HANDLER  . . . . . . . . . .  	L NEAR	0165	_TEXT
SET_INTERRUPT_HANDLER  . . . . .  	N PROC	00B8	_TEXT	Length = 0038

WRITE_SYMBOL . . . . . . . . . .  	L NEAR	0046	_TEXT

@CODE  . . . . . . . . . . . . .  	TEXT  _TEXT		
@CODESIZE  . . . . . . . . . . .  	TEXT  0		
Microsoft (R) Macro Assembler Version 5.10                  4/19/21 22:50:44
                                                             Symbols-2


@CPU . . . . . . . . . . . . . .  	TEXT  0101h		
@DATASIZE  . . . . . . . . . . .  	TEXT  0		
@FILENAME  . . . . . . . . . . .  	TEXT  lab5		
@VERSION . . . . . . . . . . . .  	TEXT  510		


    284 Source  Lines
    284 Total   Lines
     43 Symbols

  47740 + 451328 Bytes symbol space free

      0 Warning Errors
      0 Severe  Errors
